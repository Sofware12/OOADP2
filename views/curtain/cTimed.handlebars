<link rel="stylesheet" href="css/cTimed.css">
<script>
	window.addEventListener("load", buildIt);

	function buildIt() {
		startTime();
		hrsMenu();
		minsMenu();
		secsMenu();
		soundMenu();
		buildAudio();
	}

	function startTime() {
		var today = new Date();
		var h = today.getHours();
		var m = today.getMinutes();
		var s = today.getSeconds();
		var time = checkZero(h) + ":" + checkZero(m) + ":" + checkZero(s);
		document.getElementById("time").innerHTML =
			time;
		var t = setTimeout(startTime, 500);
	}

	function checkZero(i) {
		if (i < 10) { i = "0" + i }
		return i;
	}

	function hrsMenu() {
		var select = document.getElementById("alarmHrs");
		var hours = 23;

		for (i = 0; i <= hours; i++) {
			select.options[select.options.length] = new Option(i < 10 ? "0" + i : i, i);
		}
	}

	function minsMenu() {
		var select = document.getElementById("alarmMins");
		var mins = 59;

		for (i = 0; i <= mins; i++) {
			select.options[select.options.length] = new Option(i < 10 ? "0" + i : i, i);
		}
	}

	function secsMenu() {
		var select = document.getElementById("alarmSecs");
		var secs = 59;

		for (i = 0; i <= secs; i++) {
			select.options[select.options.length] = new Option(i < 10 ? "0" + i : i, i);
		}
	}

	function soundMenu() {
		var select = document.getElementById("mySelect");

		var array = [
			{
				name: "Birds",
				url: "https://www.freespecialeffects.co.uk/soundfx/various/forest.wav"
			},
			{
				name: "Morning",
				url: "https://www.freespecialeffects.co.uk/soundfx/computers/goodmorningfemale.wav"
			},
			{
				name: "Bells",
				url: "https://www.freespecialeffects.co.uk/soundfx/bells/church_bells_01.wav"
			}
		];

		for (var i = 0; i < array.length; i++) {

			var option = document.createElement("option");
			option.value = array[i].url;
			option.text = array[i].name;
			select.appendChild(option);
		}
	}

	function buildAudio() {
		var myDiv = document.getElementById("myDiv");
		var myAudio = document.createElement("audio");

		myAudio.src = "https://www.freespecialeffects.co.uk/soundfx/various/forest.wav";
		myAudio.id = "myAudio";
		myDiv.appendChild(myAudio);
	}

	document.getElementById("mySetButton").addEventListener("click", setAlarm);
	document.getElementById("myClearButton").addEventListener("click", clearAlarm);
	document.getElementById("mySelect").addEventListener("change", getSrc);

	function getSrc() {
		document.getElementById("myAudio").src = document.getElementById("mySelect").value;
	}


	function setAlarm() {

		var hour = document.getElementById("alarmHrs");
		var min = document.getElementById("alarmMins");
		var sec = document.getElementById("alarmSecs");

		var selectedHour = hour.options[hour.selectedIndex].value;
		var selectedMin = min.options[min.selectedIndex].value;
		var selectedSec = sec.options[sec.selectedIndex].value;

		var alarmTime = addZero(selectedHour) + ":" + addZero(selectedMin) + ":" + addZero(selectedSec);

		document.getElementById('alarmHrs').disabled = true;
		document.getElementById('alarmMins').disabled = true;
		document.getElementById('alarmSecs').disabled = true;
		document.getElementById('mySelect').disabled = true;


		setInterval(function playAlarmSound() {
			var today = new Date();
			var h = today.getHours();
			var m = today.getMinutes();
			var s = today.getSeconds();
			var time = addZero(h) + ":" + addZero(m) + ":" + addZero(s);

			if (time == alarmTime) {
				myAudio.play();
				myAudio.loop = true;
			}
		}, 1000);
	}

	function addZero(i) {
		if (i < 10) { i = "0" + i };
		return i;
	}

	function clearAlarm() {
		document.getElementById("alarmHrs").disabled = false;
		document.getElementById("alarmMins").disabled = false;
		document.getElementById("alarmSecs").disabled = false;
		document.getElementById("mySelect").disabled = false;
		document.getElementById("myAudio").disabled = false;
		myAudio.pause();
	}
</script>

<body>
	<form method="POST">
		<div class="container">
			<div class="left-side">
				<h1>Timer</h1>
				<div id="myBox">
					<div id="time"></div>
					<br>
					<h3>Set Alarm Time:</h3>
					<select id="alarmHrs" name="hour"></select>
					<select id="alarmMins" name="minute"></select>
					<select id="alarmSecs" name="second"></select>
					<br><br>
					<div id="myDiv">
						<label>Choose Alarm Sound:</label>
						<br>
						<select id="mySelect" name="sound"></select>
					</div>
					<button id="mySetButton" type="submit" formaction="/cTimed">Alarm Set</button>
					<a href="/curtain/delete/{{id}}" data-toggle="confirmation" data-title="Confirm delete?"
						id="myClearButton">Alarm Clear</a>
					<br><br>
				</div>
			</div>
	</form>
	<form method="POST">
		<div class="container">
			<div class="right-side">
				<article>
					<h1>Ambience</h1>
					<div class="ambience-box">
						<input type="radio" id="day" name="ambience" value="day" checked>
						<img src="../css/morning.png" onclick="document.getElementById('day').checked = true;"
							height="100" width="100">
						</input>
						<input type="radio" id="night" name="ambience" value="night">
						<img src="../css/night.jpg" onclick="document.getElementById('night').checked = true;"
							height="100" width="100">
						</input>
						<input type="radio" id="movie" name="ambience" value="movie">
						<img src="../css/movie.png" onclick="document.getElementById('movie').checked = true;"
							height="100" width="100">
						</input>
						<input type="radio" id="party" name="ambience" value="party">
						<img src="../css/party.png" onclick="document.getElementById('party').checked = true;"
							height="100" width="100">
						</input>
						<button id="setting" type="submit" formaction="/Ctimed/cAmbience">Set Ambience</button>
					</div>
				</article>
			</div>
		</div>
	</form>
</body>